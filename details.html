<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tell Us More</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#667eea">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="api-queue.js"></script>
  <style>
    /* your styles unchanged */
  </style>
</head>
<body>
  <div class="container">
    <div class="emoji">âœ¨</div>
    <div class="greeting" id="greeting"></div>
    <h2>Tell us more about you</h2>

    <input type="text" id="class" placeholder="What class are you in?" autocomplete="off">
    <input type="number" id="age" placeholder="Your age" min="1" max="120">

    <select id="gender">
      <option value="">Select Gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Non-binary">Non-binary</option>
      <option value="Prefer not to say">Prefer not to say</option>
    </select>

    <input type="text" id="mood" placeholder="What's your vibe today?" autocomplete="off">

    <div class="mood-suggestions">
      <span class="mood-tag" data-mood="excited">ðŸ˜„ Excited</span>
      <span class="mood-tag" data-mood="chill">ðŸ˜Ž Chill</span>
      <span class="mood-tag" data-mood="motivated">ðŸ’ª Motivated</span>
      <span class="mood-tag" data-mood="creative">ðŸŽ¨ Creative</span>
    </div>

    <!-- âœ… Missing button added -->
    <button id="clubhouse">INTO THE CLUBHOUSE ðŸŽ‰</button>

    <!-- âœ… Missing error div added -->
    <div id="error" class="error"></div>
  </div>

  <script>
    const SUPABASE_URL = 'https://yqzlwsmpkqeocyhduizf.supabase.co';
    const SUPABASE_ANON_KEY = 'YOUR-ANON-KEY-HERE';
    const CLUBHOUSE_AUDIO = 'your-audio-file.mp3';

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const audio = new Audio(CLUBHOUSE_AUDIO);

    document.addEventListener('DOMContentLoaded', () => {
      const userName = sessionStorage.getItem('user_name');
      const greeting = document.getElementById('greeting');
      if (userName) greeting.textContent = `Hey ${userName}! ðŸ‘‹`;

      const classInput = document.getElementById('class');
      const ageInput = document.getElementById('age');
      const genderSelect = document.getElementById('gender');
      const moodInput = document.getElementById('mood');
      const clubhouseBtn = document.getElementById('clubhouse');
      const errorDiv = document.getElementById('error');

      // Mood tag clicks
      document.querySelectorAll('.mood-tag').forEach(tag => {
        tag.addEventListener('click', () => {
          moodInput.value = tag.dataset.mood;
          moodInput.focus();
        });
      });

      // Hide error when typing
      [classInput, ageInput, genderSelect, moodInput].forEach(el => {
        el.addEventListener('input', () => errorDiv.style.display = 'none');
      });

      // Button handler
      clubhouseBtn.addEventListener('click', async () => {
        const userId = sessionStorage.getItem('user_id');
        const userClass = classInput.value.trim();
        const age = parseInt(ageInput.value);
        const gender = genderSelect.value;
        const mood = moodInput.value.trim();

        if (!userClass) return showError('Please tell us your class ðŸ“š');
        if (!age || age < 1 || age > 120) return showError('Please enter a valid age ðŸŽ‚');
        if (!gender) return showError('Please select your gender ðŸŒˆ');
        if (!mood) return showError('Tell us your vibe! ðŸ’­');
        if (!userId) {
          showError('Session expired. Please start over.');
          setTimeout(() => window.location.href = 'name.html', 2000);
          return;
        }

        clubhouseBtn.disabled = true;
        clubhouseBtn.textContent = 'Getting everything ready... âœ¨';

        try {
          const { error } = await supabaseClient
            .from('profiles')
            .update({ class: userClass, age, gender, mood })
            .eq('id', userId);

          if (error) throw error;

          audio.play().catch(err => console.log('Audio failed:', err));

          setTimeout(() => {
            // âœ… Fixed: go to mainpage.html
            window.location.href = 'mainpage.html';
          }, 1000);

        } catch (err) {
          console.error('Error saving details:', err);
          showError('Oops! Something went wrong. Please try again. ðŸ˜•');
          clubhouseBtn.disabled = false;
          clubhouseBtn.textContent = 'INTO THE CLUBHOUSE ðŸŽ‰';
        }
      });

      function showError(msg) {
        errorDiv.textContent = msg;
        errorDiv.style.display = 'block';
      }
    });
  </script>
</body>
</html>







